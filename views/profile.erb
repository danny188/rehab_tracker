<h1 class="row justify-content-center"><%= @user.first_name || @user.username %>'s Profile</h1>
<br>

<div class="row justify-content-center">


  <form action="/users/<%= @user.username %>/profile/update" method="post" class="form-horizontal col-3">


    <div class="form-group">
      <label class="sr-only" for="username" >Username</label>
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text">@</span>
        </div>
        <input type="text" class="form-control" id="username" placeholder="Pick a username (required)" name="username" value="<%= @user.username %>" readonly>
      </div>
    </div>

    <div class="form-group">
      <label class="sr-only" for="email">Email address</label>
      <input type="email" class="form-control" name="email" id="email" placeholder="Enter email" value="<%= @user.email %>">
      <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
    </div>

    <div class="form-group">
      <label class="sr-only" for="first_name">First Name</label>
      <input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" value="<%= @user.first_name %>">
    </div>


    <div class="form-group">
      <label class="sr-only" for="last_name">Last Name</label>
      <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" value="<%= @user.last_name %>">
    </div>

    <div class="form-group">
      <label class="sr-only" for="current_password">Current Password</label>
      <input type="password" id="current_password" class="form-control" name="current_password" placeholder="Current Password (required)" <% 'required' unless session[:user].role == :admin %>>
      <small id="passwordHelp" class="form-text text-muted"></small>
    </div>

    <div class="form-group">
      <label class="sr-only" for="new_password">New Password</label>
      <input type="password" id="new_password" class="form-control" name="new_password" placeholder="New Password">
      <small id="passwordHelp" class="form-text text-muted"></small>
    </div>

    <div class="form-group">
      <label class="sr-only" for="confirm_new_password">Confirm New Password</label>
      <input type="password" class="form-control" id="confirm_new_password" name="confirm_new_password" placeholder="Confirm New Password">
    </div>

    <div class="form-group">
      <label for="role">Your Role (required)</label>

      <!-- hidden input is needed because 'select' element is disabled and not sent in form submission if signed in user is not admin -->
      <% unless @user.role == :admin %>
      <input type="hidden" name="role" value="<%= @user.role.to_s %>">
      <% end %>

      <select class="custom-select mr-sm-2" name="role" id="role" required <%= 'disabled' unless session[:user].role == :admin %>>
        <option <%= 'selected' unless @user.role %>>Choose...</option>
        <option value="patient" <%= 'selected' if @user.role == :patient %>>Patient</option>

        <% if session[:user].role == :therapist || session[:user].role == :admin %>
        <option value="therapist"<%= 'selected' if @user.role == :therapist %>>Therapist</option>
        <% end %>
        <% if session[:user].role == :admin %>
        <option value="admin"<%= 'selected' if @user.role == :admin %>>Admin</option>
        <% end %>
      </select>
      <small id="role_help" class="form-text text-muted"></small>
    </div>

    <div class="form-group text-center">
      <label class="sr-only" for="create">Create Account</label>
      <button type="submit" class="btn btn-outline-primary col-5 mr-2" id="create">Save Changes</button>
      <a href="/" class="btn btn-outline-secondary col-5" id="create">Cancel</a>
    </div>
  </form>
</div>

<!-- success/error messages -->

<br>


<% if session[:warning] %>
<div class="offset-4 col-4 alert alert-warning fade show text-center" role="alert">

  <span><%= session.delete(:warning) %></span>
</div>
<% end %>

<% if session[:success] %>
<div class="offset-4 col-4 alert alert-success fade show text-center" role="alert">

  <span><%= session.delete(:success) %></span>
</div>
<% end %>

<% if session[:error] %>
<div class="offset-4 col-4 alert alert-danger fade show text-center" role="alert">

  <span><%= session.delete(:error) %></span>
</div>
<% end %>