


<div class="row">

    <h1 class="col-3 ml-3">Exercise Tracker</h1>
    <h3 class="offset-7 date-controller">Dates</h3>
    <a href="/users/<%= @patient.username %>/exercises?end_date=<%= (@end_date-7).strftime("%Y%m%d") %>" class="btn btn-info date-nav-button" data-toggle="tooltip" title="View earlier days"><i class="fas fa-arrow-left"></i></a>
    <a href="/users/<%= @patient.username %>/exercises?end_date=<%= (@end_date+7).strftime("%Y%m%d") %>" class="btn btn-info date-nav-button" data-toggle="tooltip" title="View later days"><i class="fas fa-arrow-right"></i></a>
  <!-- ajax versions of date nav -->
    <!-- <button type="button" onclick="reloadDates(<%= (@end_date-1).strftime("%Y%m%d") %>)" class="btn btn-warning date-nav-button" data-toggle="tooltip" title="View earlier days"><i class="fas fa-arrow-left"></i></a>
      <button type="button" onclick="reloadDates(<%= (@end_date+1).strftime("%Y%m%d") %>)" class="btn btn-warning date-nav-button" data-toggle="tooltip" title="View later days"><i class="fas fa-arrow-right"></i></a> -->
</div>


<hr>



<div class="row spacer-top header-row">
  <div class="col-5">
    <span class="ml-3 header dates">Exercises</span>
  </div>

  <% @dates.each do |date| %>
  <div class="col-lg-1 text-center">
    <span class="dates"><%= format_date(date) %></span>
  </div>
  <% end %>
</div>


<!-- List of current exercises -->
<% @patient.exercises.each do |exercise| %>
<div class="row exercise-row">
  <div class="col-lg-3">
    <span class="exercise col-4"><%= exercise.name %></span>
  </div>
  <div class="col-lg-2">
    <% if exercise.reps || exercise.sets %>
    <span class="badge badge-info align-bottom reps-sets"><%= [("#{exercise.reps} reps" if exercise.reps), ("#{exercise.sets} " + (exercise.sets.to_i > 1 ? "sets" : "set") if exercise.sets)].compact.join(", ") %></span>
    <% end %>

    <a class="float-right btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Actions
    </a>

    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">

      <a href="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/edit" class="dropdown-item text-primary" data-toggle="tooltip" title="View/change exercise instructions or add comments.">View/Edit</a>
      <a href="#" class="dropdown-item"><i class="fas fa-arrow-down"></i> Move exercise down</a>
      <a href="#" class="dropdown-item"><i class="fas fa-arrow-up"></i> Move exercise up</a>
      <form action="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/delete" method="post">
        <button type="submit"  class="dropdown-item text-danger" data-toggle="tooltip" title="Delete exercise and associated data.">Delete</a>
      </form>
    </div>


<!--
      <a href="#" class="btn btn-outline-danger exercise-button float-right" data-toggle="tooltip" title="Delete exercise and associated data.">Delete</a>
      <a href="#" class="btn btn-secondary exercise-button float-right" data-toggle="tooltip" title="Move exercise up"><i class="fas fa-arrow-up"></i></a>
      <a href="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/edit" class="btn btn-secondary exercise-button float-right" data-toggle="tooltip" title="View/change exercise instructions or add comments.">View/Edit</a> -->

  </div>


  <!-- Checkboxes for each day for each exercise -->
  <% @dates.each do |date| %>
  <div class="col-lg-1">
    <form action="/users/<%= @patient.username %>/update_tracker" method="post">
      <div class="custom-control custom-checkbox text-center">
        <input type="checkbox" class="custom-control-input" id="chk_<%= exercise.name + "_" + date.strftime("%Y%m%d") %>" name="checkbox_value" value="checkbox_value <%= check_value(date, exercise.record_of_days) %>" <%= "checked" if exercise.done_on?(date.strftime("%Y%m%d")) %>>
        <input type="hidden" name="exercise_name" value="<%= exercise.name %>">
        <input type="hidden" name="date" value="<%= date.strftime("%Y%m%d") %>">
        <label class="custom-control-label custom-checkbox " for="chk_<%= exercise.name + "_" + date.strftime("%Y%m%d") %>"></label>
      </div>
    </form>
  </div>
  <% end %>

</div>
<% end %>

  <!-- Form to add new exercises -->
<br>
<br>
<form class="" id="form_add_exercise" action="/users/<%=@patient.username%>/exercises/add" method="post">
  <div class="form-row">
    <div class="form-group col-5">
      <div class="input-group">
        <label class = "sr-only" for="formGroupExampleInput">Name of new exercise</label>
        <input type="text"  class="form-control" name="new_exercise_name" placeholder="Name of new exercise">
        <div class="col-1"></div><!--  spacer-column -->
        <button type="submit" class="input-group-btn btn btn-outline-primary add-new-exercise">Add Exercise</button>
      </div>
    </div>
  </div>
</form>

<% if @therapist %>
<!-- nextup -->

<% end %>