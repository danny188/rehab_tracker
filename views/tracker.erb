<div class=" d-flex justify-content-between">
  <h1><%= @patient.first_name || @patient.username %>'s Exercises</h1></span>

  <span >
    <% if session[:error] %>
    <div class="row justify-content-center">
      <div class="alert alert-danger fade show" role="alert">
        <span><%= session.delete(:error) %></span>
      </div>
    </div>
    <% end %>

    <% if session[:success] %>
    <div class=" col-5 alert alert-success fade show text-center mx-auto" role="alert">
      <span><%= session.delete(:success) %></span>
    </div>
    <% end %>
    <span class="spinner-border text-info" id="save-change-spinner" role="status">
      <span class="sr-only">Saving changes, please wait...</span>
    </span>
    <span class="text-info ml-2 pt-1" id="save-change-spinner-label">Saving changes, please wait...</span>
  </span>

  <span class="">
    <h3 class="d-inline date-controller">Dates</h3>
    <a href="/users/<%= @patient.username %>/exercises?end_date=<%= (@end_date-7).strftime("%Y%m%d") %>" class="btn btn-info date-nav-button" data-toggle="tooltip" title="View earlier days"><i class="fas fa-arrow-left"></i></a>
    <a href="/users/<%= @patient.username %>/exercises?end_date=<%= (@end_date+7).strftime("%Y%m%d") %>" class="btn btn-info date-nav-button" data-toggle="tooltip" title="View later days"><i class="fas fa-arrow-right"></i></a>
  </span>
</div>

<!--
  <div class="row d-flex justify-content-between">
    <div class="col-8 ml-4 mr-5">

      <div class="row heading-row">
        <h1><%= @patient.first_name || @patient.username %>'s Exercises</h1>
        <div class="col">
          <div class="spinner-border text-info" id="save-change-spinner" role="status">
            <span class="sr-only">Saving changes, please wait...</span>
          </div>
          <span class="text-info ml-2 pt-1" id="save-change-spinner-label">Saving changes, please wait...</span>
        </div>
      </div>

    </div>
    <div class="col-2 offset-1  mr-0 pr-0">
      <div class="row float-right">
        <h3 class="date-controller">Dates</h3>
        <a href="/users/<%= @patient.username %>/exercises?end_date=<%= (@end_date-7).strftime("%Y%m%d") %>" class="btn btn-info date-nav-button" data-toggle="tooltip" title="View earlier days"><i class="fas fa-arrow-left"></i></a>
        <a href="/users/<%= @patient.username %>/exercises?end_date=<%= (@end_date+7).strftime("%Y%m%d") %>" class="btn btn-info date-nav-button" data-toggle="tooltip" title="View later days"><i class="fas fa-arrow-right"></i></a>
      </div>
    </div>
     ajax versions of date nav
    - <button type="button" onclick="reloadDates(<%= (@end_date-1).strftime("%Y%m%d") %>)" class="btn btn-warning date-nav-button" data-toggle="tooltip" title="View earlier days"><i class="fas fa-arrow-left"></i></a>
      <button type="button" onclick="reloadDates(<%= (@end_date+1).strftime("%Y%m%d") %>)" class="btn btn-warning date-nav-button" data-toggle="tooltip" title="View later days"><i class="fas fa-arrow-right"></i></a>
      </div> -->


      <hr>



      <div class="row spacer-top header-row">
        <div class="col-5">
          <span class="ml-3 header dates">Exercises</span>
        </div>

        <% @dates.each do |date| %>
        <div class="col-1 text-center">
          <span class="dates"><%= format_date(date) %></span>
        </div>
        <% end %>
      </div>

      <!-- select all/none button -->
      <% if @patient.num_of_exercises > 0 %>
      <div class="row exercise-row">
        <div class="col-5">
          <span class="ml-3 header"></span>
        </div>

        <% @dates.each do |date| %>

        <div class="col-1 text-center mb-3">
         <form method="post" action="/users/<%= @patient.username %>/exercises/mark_all">
          <!-- <button type="button" class="border-0 px-4 btn btn-outline-secondary square"></button> -->

          <div class="custom-control custom-checkbox">
            <input type="checkbox" class="border-primary custom-checkbox custom-control-input" id="<%="select_all_none_" + date.strftime("%Y%m%d") %>" name="select_all_none" value="select_all_none" <%= "checked" if @patient.done_all_exercises?(date.strftime("%Y%m%d")) %>>
            <label class="pr-3 custom-checkbox custom-control-label border-primar" for="<%="select_all_none_" + date.strftime("%Y%m%d") %>" data-toggle="tooltip" title="Check all/none"></label>
            <input type="hidden" name="date" value="<%= date.strftime("%Y%m%d") %>">
          </div>
        </form>
      </div>

      <% end %>
    </div>

    <% else %>
    <div class="col-5">
      <span class="">No exercises added yet</span>
    </div>

    <% end %>


    <% content_for :exercise_row do |exercise, indent|%>
    <div class="row exercise-row">
      <div class="col-lg-3">
        <span class="exercise col-4 offset-<%= indent %>"><%= exercise.name %></span>
      </div>
      <div class="col-lg-2">
        <% if exercise.reps || exercise.sets %>
        <span class="badge badge-info reps-sets my-2"><%= reps_and_sets_str(exercise) %></span>
        <% end %>

        <a class="float-right btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Actions
        </a>

        <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">

          <a href="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/edit" class="dropdown-item text-primary" data-toggle="tooltip" title="View/change exercise instructions or add comments.">View/Edit</a>
          <a href="#" class="dropdown-item"><i class="fas fa-arrow-down"></i> Move exercise down</a>
          <a href="#" class="dropdown-item"><i class="fas fa-arrow-up"></i> Move exercise up</a>
          <form action="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this exercises? This cannot be reversed. Click OK to proceed.');">
            <button type="submit"  class="dropdown-item text-danger" data-toggle="tooltip" title="Delete exercise and associated data.">Delete</button>
          </form>
        </div>


<!--
      <a href="#" class="btn btn-outline-danger exercise-button float-right" data-toggle="tooltip" title="Delete exercise and associated data.">Delete</a>
      <a href="#" class="btn btn-secondary exercise-button float-right" data-toggle="tooltip" title="Move exercise up"><i class="fas fa-arrow-up"></i></a>
      <a href="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/edit" class="btn btn-secondary exercise-button float-right" data-toggle="tooltip" title="View/change exercise instructions or add comments.">View/Edit</a> -->

    </div>


    <!-- Checkboxes for each day for each exercise -->
    <% @dates.each do |date| %>
    <div class="col-1">
      <form action="/users/<%= @patient.username %>/update_tracker" method="post">
        <div class="custom-control custom-checkbox text-center">
          <input type="checkbox" class="custom-control-input" id="chk_<%= exercise.name + "_" + date.strftime("%Y%m%d") %>" name="checkbox_value" value="checkbox_value <%= check_value(date, exercise.record_of_days) %>" <%= "checked" if exercise.done_on?(date.strftime("%Y%m%d")) %>>
          <input type="hidden" name="exercise_name" value="<%= exercise.name %>">
          <input type="hidden" name="date" value="<%= date.strftime("%Y%m%d") %>">
          <label class="pr-3 custom-control-label custom-checkbox " for="chk_<%= exercise.name + "_" + date.strftime("%Y%m%d") %>"></label>
        </div>
      </form>
    </div>
    <% end %>

  </div>
  <% end %>

  <!-- display exercise groups -->
  <% @patient.get_groups(['main']).each do |group| %>
    <div class="row exercise-row">
      <span class="exercise col-4">
        <%= group.name %>
      </span>
    </div>
    <!-- display exercises in group -->
    <% group.items do |exercise| %>
      <%= yield_content :exercise_row, exercise, 1 %>
    <% end %>
  <% end %>



  <!-- List of current exercises -->
  <% @patient.get_all_exercises.each do |exercise| %>
  <div class="row exercise-row">
    <div class="col-lg-3">
      <span class="exercise col-4"><%= exercise.name %></span>
    </div>
    <div class="col-lg-2">
      <% if exercise.reps || exercise.sets %>
      <span class="badge badge-info reps-sets my-2"><%= reps_and_sets_str(exercise) %></span>
      <% end %>

      <a class="float-right btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Actions
      </a>

      <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">

        <a href="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/edit" class="dropdown-item text-primary" data-toggle="tooltip" title="View/change exercise instructions or add comments.">View/Edit</a>
        <a href="#" class="dropdown-item"><i class="fas fa-arrow-down"></i> Move exercise down</a>
        <a href="#" class="dropdown-item"><i class="fas fa-arrow-up"></i> Move exercise up</a>
        <form action="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this exercises? This cannot be reversed. Click OK to proceed.');">
          <button type="submit"  class="dropdown-item text-danger" data-toggle="tooltip" title="Delete exercise and associated data.">Delete</button>
        </form>
      </div>


<!--
      <a href="#" class="btn btn-outline-danger exercise-button float-right" data-toggle="tooltip" title="Delete exercise and associated data.">Delete</a>
      <a href="#" class="btn btn-secondary exercise-button float-right" data-toggle="tooltip" title="Move exercise up"><i class="fas fa-arrow-up"></i></a>
      <a href="/users/<%= @patient.username %>/exercises/<%= exercise.name %>/edit" class="btn btn-secondary exercise-button float-right" data-toggle="tooltip" title="View/change exercise instructions or add comments.">View/Edit</a> -->

    </div>


    <!-- Checkboxes for each day for each exercise -->
    <% @dates.each do |date| %>
    <div class="col-1">
      <form action="/users/<%= @patient.username %>/update_tracker" method="post">
        <div class="custom-control custom-checkbox text-center">
          <input type="checkbox" class="custom-control-input" id="chk_<%= exercise.name + "_" + date.strftime("%Y%m%d") %>" name="checkbox_value" value="checkbox_value <%= check_value(date, exercise.record_of_days) %>" <%= "checked" if exercise.done_on?(date.strftime("%Y%m%d")) %>>
          <input type="hidden" name="exercise_name" value="<%= exercise.name %>">
          <input type="hidden" name="date" value="<%= date.strftime("%Y%m%d") %>">
          <label class="pr-3 custom-control-label custom-checkbox " for="chk_<%= exercise.name + "_" + date.strftime("%Y%m%d") %>"></label>
        </div>
      </form>
    </div>
    <% end %>

  </div>
  <% end %>


  <br>
  <br>
  <br>

  <!-- Form to add new exercises -->
  <form class="col-lg-12" id="form_add_exercise" action="/users/<%=@patient.username%>/exercises/add" method="post">
    <div class="form-row">
      <div class="form-group col-5">

        <div class="input-group">
          <label class = "sr-only" for="formGroupExampleInput">Name of new exercise</label>
          <input type="text"  class="form-control col-8" name="new_exercise_name" placeholder="Name of new exercise">
          <div class="col-1"></div><!--  spacer-column -->
          <button type="submit" class="col-3 input-group-btn btn btn-outline-primary">Add Exercise</button>
        </div>
      </div>
      <% if session[:user].role == :therapist || session[:user].role == :admin %>
      <br>
      <div class="">
        <a href="/users/<%= @patient.username %>/exercises/add_from_library" class="btn btn-outline-primary ml-1">Choose From Exercise Library</a>
      </div>
      <% end %>
    </div>

    <div class="form-row">
      <div class="input-group col-5">
        <label for="add_to_group" class="">Add for group: </label>
        <div class="col-1"></div><!--  spacer-column -->
        <input name="add_to_group" list="add_to_group" class="form-control col-5" value="main">
        <datalist id="add_to_group">
         <option value="5"></option>
         <option value="10"></option>
         <option value="20"></option>
         <option value="30"></option>
         <option value="40"></option>
         <option value="50"></option>
         <option value="100"></option>
       </datalist>
       <div class="col-1"></div><!--  spacer-column -->
       <a href="#" class="col-3 btn btn-outline-primary">New Group</a>
     </div>
   </div>

  <!--  <div class="form-row mt-3">
    <div class="input-group col-5">
      <a href="#" class="btn btn-outline-primary">New Group</a>
    </div> -->
  </div>

</form>

<br>
